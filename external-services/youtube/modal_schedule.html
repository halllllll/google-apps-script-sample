<!--
  ã“ã“ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ãƒ¡ãƒ¢
  - HtmlService
  - GUI,ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  - ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ç‹¬è‡ªhtmlã‚’ä½œæˆ
  - template
  - templateã«Google Apps Scriptå´ã‹ã‚‰å¤‰æ•°ã‚’æ¸¡ã™
  - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã§ã‚ã‚ã†ãŒsclitpletã¯æ©Ÿèƒ½ã™ã‚‹ã“ã¨
  - ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã®form
  - google.script.run
  - html, formã®`type="datetime-local"`(çŸ¥ã‚‰ã‚“ã‹ã£ãŸ)
  - html, selectã®optionã®å€¤ã‚’é…åˆ—ã§å–å¾—ï¼ˆçŸ¥ã‚‰ã‚“ã‹ã£ãŸ)
-->
<div>
    <form id="videoScheduling" enctype="multipart/form-data" method="post">
      <div>
        <label for="videoSelection">      
          <select name="videoNames" id="videoSelection" form="videoScheduling" reqiuired>
          <option value="" style="width: 200px;">--Please choose an option--</option>
          <?!= selection ?>
          </select>
        </label>
      </div>
      <div>
        <label for="videoID">å‹•ç”»ID: <input type="text" name="videoIdInput" id="videoID" placeholder="put video id here, or choice above select box" required><label>
      </div>
      <div style="margin-top: 10px;">
      <?!= radiobuttons ?>
      </div>
      <label for="scheduledTime">å¤‰æ›´äºˆç´„æ™‚é–“:ã€€</label>
      <input type="datetime-local" id="scheduledTime"
          name="scheduledTime" value="<?!= curTime ?>"
          min="<?!= curTime ?>" required>
      <div>
        <button type="submit" id="submitBtn">ã“ã®å†…å®¹ã§äºˆç´„ã™ã‚‹</button>
      </div>
    </form>
  </div>
  <script>
    const videoSelection = document.getElementById("videoSelection");
    const videoIdInput = document.getElementById("videoID");
    const scheduledTime = document.getElementById("scheduledTime");
    videoSelection.addEventListener("change", e => {
      videoIdInput.value = e.target.value;
    });
    const form = document.getElementById("videoScheduling");
    const submitBtn = document.getElementById("submitBtn");
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      e.stopPropagation();
      // IDãŒé¸æŠè‚¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const options = [];
      Array.from(videoSelection.options, (opt) => {
        options.push(opt.value);
      });
      if(options.indexOf(videoIdInput.value) === -1){
        alert(`å‹•ç”»ID:[${videoIdInput.value}]ãŒSheetä¸Šã«å­˜åœ¨ã—ãªã„ã§ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„\nã ã‚ãªå ´åˆã¯Sheetã‚’æ›´æ–°ã—ã¦ã‹ã‚‰å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¦ãã ã•ã„`);
        return;
      }
      // ä»Šã®æ™‚é–“ãƒã‚§ãƒƒã‚¯
      const t = new Date(Date.now());
      const intervalMillsec = 30 * 60 * 1000;
      if(intervalMillsec < t-new Date(scheduledTime.value)){
        alert(`ç¾åœ¨æ™‚åˆ»ã‚ˆã‚Š${intervalMillsec/(60*1000)}åˆ†ä»¥ä¸Šã®é–“éš”ã‚’ç©ºã‘ã¦ãã ã•ã„`);
        return;
      }
  
      const now = Date.now(scheduledTime.value);
      const fd = new FormData(form);
      const obj = Object.fromEntries(fd);
      submitBtn.disabled = true;
      google.script.run.withSuccessHandler( result => {
        google.script.host.close();
      }).withFailureHandler( err =>{
        alert("å¤±æ•—ã—ã¾ã—ãŸ...ğŸ¥ºğŸ¥ºğŸ¥º");
        console.log(err);
      }).scheduleUpdate(obj);
    });
  </script>
  