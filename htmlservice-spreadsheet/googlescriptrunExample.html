<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <h1>Formã®å†…å®¹ã‚’gsã§å—ã‘å–ã£ã¦sheetã«åæ˜ </h1>
    <h2>(type: multipart/form-data)</h2>
      <form id="form1" enctype="multipart/form-data" method="post">
			<ul>
        <li>
          <label for="weekday">æ›œæ—¥ </label>
          <div>
            <select id="weekday" name="weekday"> 
              <option value="Mon" selected="selected">æœˆ</option>
              <option value="Tue">ç«</option>
              <option value="Wed">æ°´</option>
              <option value="Thu">æœ¨</option>
              <option value="Fri">é‡‘</option>
              <option value="Sat">åœŸ</option>
            </select>
	  	    </div>
        </li> 
        <li>
          <label for="period">æ™‚é™ </label>
          <div>
            <select id="period" name="period"> 
              <option value="1" selected="selected">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
            </select>
          </div> 
        </li>
        <li>
          <label for="subject">æ•™ç§‘ </label>
          <div>
            <select id="subject" name="subject"> 
              <option value="kokugo" selected="selected">å›½èª</option>
              <option value="sansu">ç®—æ•°</option>
              <option value="rika">ç†ç§‘</option>
              <option value="syakai">ç¤¾ä¼š</option>
              <option value="ongaku">éŸ³æ¥½</option>
              <option value="gakkatsu">å­¦æ´»</option>
              <option value="sogo">ç·åˆ</option>
              <option value="taiiku">ä½“è‚²</option>
              <option value="zuko">å›³å·¥</option>
              <option value="hoken">ä¿å¥</option>
              <option value="kateika">å®¶åº­ç§‘</option>
              <option value="doutoku">é“å¾³</option>
              <option value="gig">GIG</option>
            </select>
          </div> 
        </li>
        <li>
          <label for="class_URL">URL </label>
          <div>
            <input type="text" id="input_URL" name="input_URL" pattern="^(|http(|s)://[0-9a-zA-Z/#&?%\.\-\+_=]+)$" placeholder="not requiredã ã‚ˆï½"> 
          </div> 
        </li>
      </li>	
      <input id="submitForm" class="button_text" type="submit" name="submit" value="Sheetã«åæ˜ ã™ã‚‹ã‚ˆã€œ")>
      </ul>
	  </form>
    <br>
    <br>
    <h2>(type: application/json ... ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯base64ã«ã™ã‚‹ãªã©å·¥å¤«ãŒå¿…è¦ã«ãªã‚‹)</h2>
    <form id="form2" method="post">
			<ul>
        <li>
          <label for="dish">æ–™ç† </label>
          <div>
            <select id="dish" name="dish"> 
              <option value="fish" selected="selected">é­š</option>
              <option value="meat">è‚‰</option>
              <option value="vegitable">é‡èœ</option>
            </select>
	  	    </div>
        </li> 
        <li>
          <label for="inputName">Name (4 to 8 characters):</label>
          <input type="text" id="inputName" name="inputName" minlength="4" maxlength="8" size="10" required>
        </li>
        <li>
          <fieldset id="checkBoxes">
            <legend >ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹</legend>
            <label for="checkBox1"><input type="checkbox" id="checkBox1" name="fruits" value="apple">ã‚Šã‚“ã”</label>
            <label for="checkBox2"><input type="checkbox" id="checkBox2" name="fruits" value="banana">ãƒãƒŠãƒŠ</label>
            <label for="checkBox3"><input type="checkbox" id="checkBox3" name="fruits" value="grapes">ã¶ã©ã†</label>
            <label for="checkBox4"><input type="checkbox" id="checkBox4" name="fruits" value="orange">ã‚ªãƒ¬ãƒ³ã‚¸</label>
            <label for="checkBox5"><input type="checkbox" id="checkBox5" name="fruits" value="strawberry">ã„ã¡ã”</label>
          </fieldset>
        </li>
      </ul>
      <input id="submitForm2" class="button_text" type="submit" name="submit" value="GASå´ã«é€ã‚‹ã‚ˆ")>
    </form>
    <script  type="text/javascript">      
      function submitFunc1(event) {
        const formData = new FormData(form1);
        // FormDataã‚’Google Apps Scriptå´ã«ãã®ã¾ã¾é€ã£ãŸã‚‰
        // The frame attempting navigation of the top-level window is sandboxed, but the flag of 'allow-top-navigation' or 'allow-top-navigation-by-user-activation' is not set.
        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚
        const weekday = formData.get("weekday");
        const period = formData.get("period");
        const subject = formData.get("subject");
        const url = formData.get("input_URL");

        google.script.run.withSuccessHandler(function(){
          google.script.host.close();
          alert("åæ˜ ã—ã¾ã—ãŸï¼ï¼ï¼ğŸ˜¤");
        }).withFailureHandler( err =>{
          alert("å¤±æ•—ã—ã¾ã—ãŸ...ğŸ¥ºğŸ¥ºğŸ¥º");
          console.log(err);
        }).setData(weekday, period, subject, url/*, formData*/);
        event.preventDefault();
      }

      function submitFunc2(e){
        // FormData -> Object -> JSONã«ã—ã¦é€ã‚‹
        // ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã‚‹ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãªã©ã†ã¾ãã„ã‹ãªã„ï¼ˆæœ€å¾Œã«ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‚ã®ãŒå–å¾—ã•ã‚Œã‚‹ï¼‰ãŒã€ã‚„ã‚Šæ–¹ãŒã‚ã‹ã‚‰ãªã„ã®ã§ã—ã‹ãŸãªãç›´æ¥ã„ã‚Œã¦ã‚‹

        const fd = new FormData(form2);
        const obj = Object.fromEntries(fd);
        const fruits = [];
        document.getElementsByName("fruits").forEach(f=>{
          if(f.checked)fruits.push(f.value);
        });
        obj.fruits = fruits;
        const json = JSON.stringify(obj);
        console.log(obj);
        console.log(json);
        google.script.run.withSuccessHandler(function(){
          google.script.host.close();
          alert("é€ä¿¡ã—ã¾ã—ãŸï¼ï¼ï¼ğŸ˜¤");
        }).withFailureHandler( err =>{
          alert("å¤±æ•—ã—ã¾ã—ãŸ...ğŸ¥ºğŸ¥ºğŸ¥º");
          console.log(err);
        }).getDataTest(obj);
        event.preventDefault();

      }

      const form1 = document.getElementById("form1");
      form1.addEventListener("submit", submitFunc1);

      const form2 = document.getElementById("form2");
      form2.addEventListener("submit", submitFunc2);

    </script>
  </body>
</html>
